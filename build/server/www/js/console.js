var $log=$("#log"),$input=$("#input"),$form=$("#form"),$wrap=$("#wrap"),$bumper=$("#bumper"),$window=$(window),connected=!1,ws;function log(b,a,d){var c=$("<div />");c.addClass(b);c.text(a);$wrap.append(c);$input.is(":focus")&&$bumper[0].scrollIntoView();d&&log("stack",d)}
function connect(){if(!connected){log("debug","Connecting to "+document.location.hostname+":"+document.location.port+" ...");try{ws=new WebSocket("ws://"+document.location.hostname+":"+document.location.port+"/cs"),ws.onopen=function(){connected=!0;log("debug","Connected");$input.focus()},ws.onmessage=function(a){a=JSON.parse(a.data);a.type||(a.type="log");log(a.type,a.message,a.stack)},ws.onclose=function(a){connected=!1;log("debug","Disconnected: "+a.code+", "+(a.reason?a.reason:"(no reason provided)"));
a=$("<a />");a.addClass("console");a.prop("href","javascript:void(0)");a.text("Click to reconnect");a.click(function(a){a.preventDefault();connect();$(this).remove();return!1});$wrap.append(a);$bumper[0].scrollIntoView()}}catch(b){log("error",b.message)}}}
$(document).ready(function(){$form.submit(function(b){b.preventDefault();if(!connected)return!1;b=$input.val();$input.val("");$input.select();$input.focus();log("debug","> "+b);try{ws.send(b)}catch(a){log("error",a.message)}return!1});$input.focus(function(){$bumper[0].scrollIntoView()});$window.resize(onResize);onResize();connect()});function onResize(){$log.css({height:$window.innerHeight()-28+"px"})};
